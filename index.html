<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscador de Consumibles e Impresoras</title>
  <style>
    :root {
      --radius: 12px;
      --shadow: 0 4px 15px rgba(0,0,0,0.1);
      --color-printer: #e3f2fd;
      --color-consumable: #f1f8e9;
      --google-blue: #4285F4;
      --google-red: #DB4437;
      --google-yellow: #F4B400;
      --google-green: #0F9D58;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f5f5f5; color: #333;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
    }
    header {
      width: 100%; padding: 2rem 1rem;
      background: linear-gradient(90deg, var(--google-blue), var(--google-green));
      color: #fff; text-align: center;
      box-shadow: var(--shadow);
    }
    header h1 {
      font-size: 2rem; margin-bottom: 1rem;
    }
    .searchbar {
      position: relative; width: 100%; max-width: 500px; margin: 0 auto;
    }
    .searchbar input {
      width: 100%; padding: 0.75rem 1rem;
      border: none; border-radius: var(--radius);
      font-size: 1rem; transition: background 0.3s ease;
      background: #fff; box-shadow: var(--shadow);
      color: #333;
    }
    .searchbar input:focus {
      outline: none; background: #e0f7fa;
    }
    .searchbar button.clear {
      position: absolute; right: 0.5rem; top: 50%;
      transform: translateY(-50%);
      background: transparent; border: none;
      font-size: 1.2rem; cursor: pointer; color: #666;
    }
    .error {
      margin-top: 0.5rem; color: #DB4437; min-height: 1.4em;
    }
    .grid {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 1rem; width: 100%; max-width: 900px; padding: 1rem;
      flex: 1 0 auto;
    }
    .card {
      flex: 1 1 45%; background: #fff;
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 1rem; max-height: 400px; overflow-y: auto;
    }
    .card h2 {
      font-size: 1.25rem; margin-bottom: 0.5rem; text-transform: uppercase;
    }
    .card ul {
      list-style: none; padding: 0; margin: 0;
    }
    .card li {
      padding: 0.5rem 0; border-bottom: 1px solid #ddd;
      text-transform: uppercase; font-size: 0.95rem;
    }
    #consumiblesCard { background: var(--color-consumable); }
    #impresorasCard { background: var(--color-printer); }
    .google-btn {
      margin: 1rem auto 2rem;
      padding: 0.75rem 2rem;
      border: none; border-radius: var(--radius);
      background: linear-gradient(90deg, var(--google-blue), var(--google-red), var(--google-yellow), var(--google-green));
      color: #fff; font-size: 1rem; cursor: pointer;
      box-shadow: var(--shadow);
    }
  </style>
</head>
<body>
  <header>
    <h1>Buscador de Consumibles e Impresoras</h1>
    <div class="searchbar">
      <input id="searchInput" type="text" placeholder="Ej. 001R00623, HP21, Canon..." autocomplete="off">
      <button class="clear" id="clearBtn">✕</button>
    </div>
    <div class="error" id="errorMsg"></div>
  </header>

  <div class="grid">
    <div class="card" id="consumiblesCard">
      <h2>Consumibles</h2>
      <ul id="consumiblesList"></ul>
    </div>
    <div class="card" id="impresorasCard">
      <h2>Impresoras</h2>
      <ul id="impresorasList"></ul>
    </div>
  </div>

  <button class="google-btn" id="googleBtn">Buscar en Google</button>

  <script>
    let data = [];
    fetch('./consumibles_impresoras_full.json')
      .then(res => res.json())
      .then(json => data = json)
      .catch(() => document.getElementById('errorMsg').textContent = 'Error cargando datos');

    const inp = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');
    const err = document.getElementById('errorMsg');
    const consumList = document.getElementById('consumiblesList');
    const impresList = document.getElementById('impresorasList');
    const googleBtn = document.getElementById('googleBtn');

    function normalize(str) {
      return String(str).toLowerCase().normalize('NFD')
        .replace(/[̀-ͯ]/g, '')
        .replace(/[^a-z0-9 ]/g, '').trim();
    }

    clearBtn.onclick = () => {
      inp.value = ''; err.textContent = '';
      consumList.innerHTML = ''; impresList.innerHTML = ''; inp.focus();
    };

    inp.onkeydown = e => { if (e.key === 'Enter') runSearch(); };

    googleBtn.onclick = () => {
      const q = inp.value.trim();
      if (q) window.open('https://www.google.com/search?q=' + encodeURIComponent(q), '_blank');
    };

    function runSearch() {
      const raw = inp.value.trim();
      if (!raw) return;
      err.textContent = ''; consumList.innerHTML = ''; impresList.innerHTML = '';

      const q = normalize(raw);
      // filtramos filas que contengan q en REF, CONSUMIBLES, IMPRESORAS o DESCRIPCION
      const rows = data.filter(item =>
        normalize(item.REFERENCIA).includes(q) ||
        normalize(item.CONSUMIBLES).includes(q) ||
        normalize(item.IMPRESORAS).includes(q) ||
        normalize(item.DESCRIPCION).includes(q)
      );

      if (!rows.length) {
        err.textContent = `Código no encontrado: ${raw}`;
        return;
      }

      // Consumibles únicos y ordenados
      const consSet = new Set(rows.map(r => r.CONSUMIBLES.toUpperCase()));
      consSet.forEach(name => {
        const li = document.createElement('li'); li.textContent = name;
        consumList.appendChild(li);
      });

      // Impresoras únicas y ordenadas de las filas
      const impSet = new Set(rows.map(r => r.IMPRESORAS.toUpperCase()));
      impSet.forEach(name => {
        const li = document.createElement('li'); li.textContent = name;
        impresList.appendChild(li);
      });
    }
  </script>
</body>
</html>