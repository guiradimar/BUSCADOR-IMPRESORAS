<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscador de Consumibles e Impresoras</title>
  <style>
    :root { --radius: 12px; --shadow: 0 8px 20px rgba(0,0,0,0.1); }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Arial, sans-serif; background: #f0f4f8; color: #333; }
    header { background: linear-gradient(90deg, #4285F4, #34A853); padding: 2rem; text-align: center; box-shadow: var(--shadow); }
    header h1 { margin: 0; font-size: 2.5rem; color: #fff; }
    .searchbar { margin-top: 1rem; display: flex; justify-content: center; align-items: center; }
    .searchbar input { width: 300px; padding: 0.75rem 1rem; border: none; border-radius: var(--radius); font-size: 1rem; }
    .searchbar button { margin-left: 1rem; padding: 0.75rem 1.5rem; border: none; border-radius: var(--radius); background: #fff; color: #4285F4; font-size: 1rem; cursor: pointer; box-shadow: var(--shadow); }
    .error { text-align: center; color: #E53935; margin-top: 0.5rem; min-height: 1.2em; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1000px; margin: 2rem auto; }
    .card { background: #fff; border-radius: var(--radius); padding: 1rem; box-shadow: var(--shadow); min-height: 200px; overflow-y: auto; }
    .card h2 { margin-top: 0; font-size: 1.25rem; }
    .card ul { padding-left: 1rem; margin: 0; list-style: disc; }
    .btn-google { display: block; margin: 1rem auto; padding: 0.75rem 2rem; border: none; border-radius: var(--radius); background: linear-gradient(90deg,#4285F4,#FBBC05,#34A853); color: #fff; font-size: 1rem; cursor: pointer; box-shadow: var(--shadow); }
  </style>
</head>
<body>
  <header>
    <h1>Buscador de Consumibles e Impresoras</h1>
    <div class="searchbar">
      <input type="text" id="searchInput" placeholder="Ingresa referencia, modelo o nombre" />
      <button id="clearBtn">Limpiar</button>
    </div>
    <div class="error" id="errorMsg"></div>
  </header>

  <div class="grid">
    <div class="card">
      <h2>Consumibles</h2>
      <ul id="consumiblesList"></ul>
    </div>
    <div class="card">
      <h2>Impresoras</h2>
      <ul id="impresorasList"></ul>
    </div>
  </div>

  <button class="btn-google" id="googleBtn">Buscar en Google</button>

  <script>
    let data = [];
    fetch('dataset_full_with_consumibles.json')
      .then(res => res.json())
      .then(json => data = json)
      .catch(() => document.getElementById('errorMsg').textContent = 'Error cargando datos');

    const inp        = document.getElementById('searchInput');
    const clearBtn   = document.getElementById('clearBtn');
    const err        = document.getElementById('errorMsg');
    const consumList = document.getElementById('consumiblesList');
    const impresList = document.getElementById('impresorasList');
    const googleBtn  = document.getElementById('googleBtn');

    function normalize(str) {
      return str
        .normalize('NFD').replace(/[̀-ͯ]/g, '')
        .replace(/[^a-zA-Z0-9 ]/g, '')
        .toLowerCase()
        .trim();
    }

    function clearAll() {
      inp.value = '';
      err.textContent = '';
      consumList.innerHTML = '';
      impresList.innerHTML = '';
    }
    clearBtn.addEventListener('click', clearAll);

    googleBtn.addEventListener('click', () => {
      const q = inp.value.trim();
      if (q) window.open('https://www.google.com/search?q=' + encodeURIComponent(q), '_blank');
    });

    inp.addEventListener('keydown', e => {
      if (e.key === 'Enter') search();
    });

    function search() {
      const raw = inp.value;
      if (!raw) return;

      const q = normalize(raw);
      err.textContent = '';

      function matchesField(field) {
        if (!field) return false;
        if (Array.isArray(field)) {
          return field.some(f => normalize(f).includes(q));
        } else {
          return normalize(field).includes(q);
        }
      }

      const impresoras = data
        .filter(item =>
          item.CATEGORIA === 'Impresora' &&
          (
            matchesField(item.REFERENCIA) ||
            matchesField(item.NOMBRE) ||
            matchesField(item.COMPATIBILIDADES)
          )
        )
        .map(item => item.NOMBRE);

      const consumibles = data
        .filter(item =>
          item.CATEGORIA === 'Consumible' &&
          (
            matchesField(item.REFERENCIA) ||
            matchesField(item.NOMBRE) ||
            matchesField(item.COMPATIBILIDADES)
          )
        )
        .map(item => item.NOMBRE);

      consumList.innerHTML = '';
      impresList.innerHTML = '';

      if (impresoras.length === 0 && consumibles.length === 0) {
        err.textContent = `Código no encontrado: ${raw}`;
        return;
      }
      impresoras.forEach(name => {
        const li = document.createElement('li');
        li.textContent = name;
        impresList.appendChild(li);
      });
      consumibles.forEach(name => {
        const li = document.createElement('li');
        li.textContent = name;
        consumList.appendChild(li);
      });
    }
  </script>
</body>
</html>
