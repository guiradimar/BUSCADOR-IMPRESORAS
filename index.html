<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BUSCADOR DE IMPRESORAS</title>
  <style>
    :root { --gap:14px; --radius:12px; --shadow:0 4px 12px rgba(0,0,0,0.1); }
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:#f3f4f6; }
    header { background:#fff; padding:2rem 1rem; text-align:center; box-shadow:var(--shadow); }
    header h1 { font-size:2.5rem; margin-bottom:1rem; }
    .searchbar { display:flex; justify-content:center; gap:10px; }
    .searchbar input { width:250px; padding:10px 15px; border:2px solid #ccc; border-radius:999px; outline:none; transition:0.2s; }
    .searchbar input:focus { border-color:#4285f4; box-shadow:0 0 8px rgba(66,133,244,0.3); }
    .searchbar button { padding:10px 20px; border:none; border-radius:999px; background:#4285f4; color:#fff; cursor:pointer; }
    .message { text-align:center; margin:10px 0; font-size:1rem; }
    .message.error { color:#b91c1c; }
    main { max-width:1000px; margin:20px auto; padding:0 10px; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:var(--gap); }
    .panel { background:#fff; border-radius:var(--radius); padding:15px; box-shadow:var(--shadow); min-height:150px; }
    .panel h2 { margin-bottom:10px; font-size:1.2rem; }
    .panel ul { list-style:disc inside; max-height:200px; overflow-y:auto; }
    #btnGoogle { display:none; margin:20px auto; padding:10px 25px; border:none; border-radius:var(--radius);
      background:linear-gradient(90deg,#4285f4,#db4437,#f4b400,#0f9d58); color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>BUSCADOR DE IMPRESORAS</h1>
    <div class="searchbar">
      <input id="search" type="text" placeholder="Referencia, nombre o modelo" />
      <button id="clear">Limpiar</button>
    </div>
    <div id="msgError" class="message error" style="display:none"></div>
  </header>
  <main>
    <div class="grid">
      <div class="panel">
        <h2>CONSUMIBLES</h2>
        <ul id="panelConsumibles"></ul>
      </div>
      <div class="panel">
        <h2>IMPRESORAS</h2>
        <ul id="panelImpresoras"></ul>
      </div>
    </div>
    <button id="btnGoogle">BUSCAR EN GOOGLE</button>
  </main>
  <script>
    const normalize = s => s ? String(s).normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().replace(/[^a-z0-9]/g,'') : '';
    let data=[], cols=[], refCol, nombreCol, compatCol;
    async function loadData(){ try{
      const r=await fetch('dataset_clean.json'); if(!r.ok) throw 0;
      const js=await r.json(); data=js.rows; cols=js.columns;
      refCol=cols.find(c=>normalize(c).includes('referencia'));
      nombreCol=cols.find(c=>normalize(c).includes('nombre'));
      compatCol=cols.find(c=>normalize(c).includes('compatibil'));
    } catch(e){ document.getElementById('msgError').textContent='Error cargando datos'; document.getElementById('msgError').style.display='block'; }}
    function clearPanels(){
      document.getElementById('panelConsumibles').innerHTML='';
      document.getElementById('panelImpresoras').innerHTML='';
      document.getElementById('msgError').style.display='none';
      document.getElementById('btnGoogle').style.display='none';
    }
    function renderList(id, items){ const ul=document.getElementById(id); items.forEach(i=>{ const li=document.createElement('li'); li.textContent=i; ul.appendChild(li); }); }
    function onSearch(e){
      if(e.key !== 'Enter') return;
      e.preventDefault();
      const raw = document.getElementById('search').value.trim();
      const term = normalize(raw);

      clearPanels();
      if(!term) return;

      // Filtrar consumibles por referencia o nombre
      const consumRows = data.filter(r =>
        (r[refCol] && normalize(r[refCol]).includes(term)) ||
        (r[nombreCol] && normalize(r[nombreCol]).includes(term))
      );

      // Extraer impresoras de compatibilidades de los consumibles encontrados
      const printers = new Set();
      consumRows.forEach(r => {
        if(r[compatCol]) {
          r[compatCol].split(',').forEach(c => {
            const p = c.trim(); if(p) printers.add(p);
          });
        }
      });

      if(!consumRows.length && printers.size === 0){
        const err = document.getElementById('msgError');
        err.textContent = `CÃ“DIGO NO ENCONTRADO: ${raw}`;
        err.style.display = 'block';
        const btn = document.getElementById('btnGoogle');
        btn.style.display = 'block';
        btn.onclick = () => window.open(
          `https://google.com/search?q=${encodeURIComponent(raw)}`,
          '_blank'
        );
        return;
      }

      // Renderizar consumibles
      if(consumRows.length) renderList('panelConsumibles', consumRows.map(r => r[nombreCol]));
      // Renderizar impresoras
      if(printers.size) renderList('panelImpresoras', [...printers]);
    }
    document.getElementById('search').addEventListener('keydown', onSearch);
    document.getElementById('clear').addEventListener('click', () => { document.getElementById('search').value = ''; clearPanels(); });
    window.addEventListener('load', () => { loadData(); clearPanels(); });('load',()=>{loadData(); clearPanels();});('load',()=>{loadData(); clearPanels();});
  </script>
</body>
</html>
