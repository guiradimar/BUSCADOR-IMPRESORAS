<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscador de Consumibles e Impresoras</title>
  <style>
    :root { --radius: 12px; --shadow: 0 8px 20px rgba(0,0,0,0.1); }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: 'Arial', sans-serif;
      background: #f0f4f8; color: #333;
    }
    header {
      background: linear-gradient(90deg,#4285F4,#34A853);
      padding: 2rem; text-align: center;
      box-shadow: var(--shadow);
    }
    header h1 { margin: 0; font-size: 2.5rem; color: #fff; }
    .searchbar {
      margin-top: 1rem; display: flex; justify-content: center;
    }
    .searchbar input {
      width: 400px; padding: 0.75rem 1rem;
      border: none; border-radius: var(--radius);
      font-size: 1rem;
    }
    .searchbar button {
      margin-left: 1rem;
      padding: 0.75rem 1.5rem;
      border: none; border-radius: var(--radius);
      background: #fff; color: #4285F4;
      font-size: 1rem; cursor: pointer;
      box-shadow: var(--shadow);
    }
    .error {
      text-align: center; color: #E53935;
      margin-top: 0.5rem;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 1000px; margin: 2rem auto;
    }
    .card {
      background: #fff; border-radius: var(--radius);
      padding: 1rem; box-shadow: var(--shadow);
      max-height: 300px; overflow-y: auto;
    }
    .card h2 { margin-top: 0; font-size: 1.25rem; }
    .card ul { padding-left: 1rem; }
    .btn-google {
      display: block; margin: 1rem auto;
      padding: 0.75rem 2rem;
      border: none; border-radius: var(--radius);
      background: linear-gradient(90deg,#4285F4,#FBBC05,#34A853);
      color: #fff; font-size: 1rem;
      cursor: pointer; box-shadow: var(--shadow);
    }
  </style>
</head>
<body>
  <header>
    <h1>Buscador de Consumibles e Impresoras</h1>
    <div class="searchbar">
      <input type="text" id="searchInput" placeholder="Ingrese referencia o modelo">
      <button id="clearBtn">Limpiar</button>
    </div>
    <div class="error" id="errorMsg"></div>
  </header>

  <div class="grid">
    <div class="card" id="consumiblesCard">
      <h2>Consumibles</h2>
      <ul id="consumiblesList"></ul>
    </div>
    <div class="card" id="impresorasCard">
      <h2>Impresoras</h2>
      <ul id="impresorasList"></ul>
    </div>
  </div>
  <button class="btn-google" id="googleBtn">Buscar en Google</button>

  <script>
    let data = null;
    fetch('dataset_full_with_consumibles.json')
      .then(res=>res.json()).then(json=>{ data = json.rows; })
      .catch(err=> document.getElementById('errorMsg').textContent = 'Error cargando datos');

    const inp = document.getElementById('searchInput');
    const clear = document.getElementById('clearBtn');
    const err = document.getElementById('errorMsg');
    const cList = document.getElementById('consumiblesList');
    const iList = document.getElementById('impresorasList');
    const gBtn = document.getElementById('googleBtn');

    function render(items, listEl) {
      listEl.innerHTML = '';
      items.forEach(it=>{
        const li = document.createElement('li');
        li.textContent = it;
        listEl.appendChild(li);
      });
    }

    inp.addEventListener('keypress', e=>{
      if(e.key==='Enter') doSearch();
    });
    clear.addEventListener('click', ()=>{
      inp.value = '';
      err.textContent = '';
      render([], cList);
      render([], iList);
    });
    gBtn.addEventListener('click', ()=>{
      const q = inp.value.trim();
      if(q) window.open('https://www.google.com/search?q='+encodeURIComponent(q));
    });

    function doSearch(){
      const q = inp.value.trim().toLowerCase();
      if(!data) return;
      if(!q) return;
      err.textContent = '';

      // buscar en compatList (impresoras)
      const imp = data.filter(r=> r.COMPATIBILIDADES.toLowerCase().includes(q))
                      .flatMap(r=> r.COMPATIBILIDADES.split(','))
                      .map(x=> x.trim())
                      .filter(x=> x.toLowerCase().includes(q));
      // buscar consumibles por referencia o nombre
      const cons = data.filter(r=> r.REFERENCIA.toLowerCase().includes(q)
                         || r.NOMBRE.toLowerCase().includes(q))
                       .map(r=> r.NOMBRE);

      if(imp.length) render(imp, iList);
      if(cons.length) render(cons, cList);
      if(!imp.length && !cons.length) err.textContent = `CÃ³digo no encontrado: ${q}`;
    }
  </script>
</body>
</html>
