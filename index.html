<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buscador de Consumibles e Impresoras</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    header { background: #4285F4; color: white; padding: 20px; text-align: center; }
    header h1 { margin: 0; }
    .search-container { display: flex; justify-content: center; margin: 20px; }
    .search-container input { width: 300px; padding: 10px; border: 1px solid #ccc; border-radius: 4px 0 0 4px; }
    .search-container button { padding: 10px; border: 1px solid #ccc; background: #0F9D58; color: white; cursor: pointer; border-radius: 0 4px 4px 0; }
    .results { display: flex; justify-content: space-around; margin: 20px; }
    .box { background: white; padding: 10px; width: 40%; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .box h2 { margin-top: 0; }
    .box ul { list-style: none; padding: 0; }
    .box li { padding: 5px 0; border-bottom: 1px solid #eee; }
    .google-btn { display: block; margin: 20px auto; padding: 10px 20px; background: #DB4437; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .error { color: red; text-align: center; }
  </style>
</head>
<body>
  <header>
    <h1>BUSCADOR DE CONSUMIBLES E IMPRESORAS</h1>
  </header>
  <div class="search-container">
    <input id="searchInput" placeholder="Ej. HP301, CH561EE, Canon TS3350"/>
    <button id="clearBtn">Limpiar</button>
  </div>
  <div class="error" id="errorMsg"></div>
  <div class="results">
    <div class="box">
      <h2>Consumibles</h2>
      <ul id="consumibles"></ul>
    </div>
    <div class="box">
      <h2>Impresoras</h2>
      <ul id="impresoras"></ul>
    </div>
  </div>
  <button class="google-btn" id="googleBtn">Buscar en Google</button>

  <script>
    // Sample data load check
    let data = [];
    fetch('consumibles_impresoras_full.json')
      .then(res => res.json())
      .then(json => {
        data = json;
        console.log('JSON cargado, registros:', data.length);
      })
      .catch(err => {
        console.error('Error al cargar JSON:', err);
        document.getElementById('errorMsg').textContent = 'Error cargando datos';
      });

    const inp = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');
    const googleBtn = document.getElementById('googleBtn');
    const errorMsg = document.getElementById('errorMsg');
    const consList = document.getElementById('consumibles');
    const impList = document.getElementById('impresoras');

    clearBtn.addEventListener('click', () => {
      inp.value = '';
      errorMsg.textContent = '';
      consList.innerHTML = '';
      impList.innerHTML = '';
      inp.focus();
      console.log('Clear clicked');
    });

    googleBtn.addEventListener('click', () => {
      const q = inp.value.trim();
      if (q) {
        window.open('https://www.google.com/search?q=' + encodeURIComponent(q), '_blank');
      }
    });

    inp.addEventListener('keyup', e => {
      if (e.key === 'Enter') doSearch();
    });

    function doSearch() {
      const q = inp.value.trim().toLowerCase();
      if (!q) return;
      consList.innerHTML = '';
      impList.innerHTML = '';
      errorMsg.textContent = '';

      // Find consumibles by reference or name
      const foundCons = data.filter(r =>
        r.REFERENCIA.toLowerCase().includes(q) ||
        (r.CONSUMIBLES && r.CONSUMIBLES.toLowerCase().includes(q))
      );
      // Find impresoras by name or compat
      const foundImp = data.filter(r =>
        r.IMPRESORAS.toLowerCase().includes(q) ||
        r.COMPATIBILIDADES.some(c => c.toLowerCase().includes(q))
      );

      if (foundCons.length) {
        foundCons.forEach(r => {
          const li = document.createElement('li');
          li.textContent = r.CONSUMIBLES || 'SIN CONSUMIBLE';
          consList.appendChild(li);
        });
      }

      if (foundImp.length) {
        foundImp.forEach(r => {
          const li = document.createElement('li');
          li.textContent = r.IMPRESORAS;
          impList.appendChild(li);
        });
      }

      if (!foundCons.length && !foundImp.length) {
        errorMsg.textContent = 'CÃ³digo no encontrado: ' + inp.value.trim();
      }
    }
  </script>
</body>
</html>
