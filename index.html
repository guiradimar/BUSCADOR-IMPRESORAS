<!doctype html>
<html lang="es">
<head>
<<<<<<< HEAD
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Buscador de Impresoras</title>
  <meta name="description" content="Buscador de consumibles e impresoras compatible con GitHub Pages / Netlify (estático).">
  <style>
    :root { --gap: 14px; --radius: 14px; --shadow: 0 8px 20px rgba(0,0,0,.06); }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #f6f7f9; color: #0b0c0c; }
    header { position: sticky; top: 0; background: linear-gradient(90deg,#ffffff,#fafafa); border-bottom: 1px solid #e5e7eb; z-index: 10; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 18px; }
    h1 { margin: 0 0 10px; font-size: clamp(20px, 2.8vw, 28px); }
    .searchbar { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }
    .searchbar input[type="search"] {
      width: 100%; padding: 14px 16px; border-radius: 999px;
      border: 2px solid #d1d5db; outline: none; background: #fff; transition: border-color .2s, box-shadow .2s, background .2s;
      box-shadow: var(--shadow);
    }
    .searchbar input[type="search"].active { animation: pulseBg 1s ease-in-out infinite alternate; }
    .searchbar button { padding: 12px 18px; border-radius: 999px; border: 1px solid #d1d5db; background: #fff; cursor: pointer; box-shadow: var(--shadow); }
    @keyframes pulseBg {
      0%   { background: #fff4f4; border-color: #fca5a5; }
      50%  { background: #f0fff4; border-color: #86efac; }
      100% { background: #f0f9ff; border-color: #93c5fd; }
=======
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BUSCADOR CONSUMIBLES/IMPRESORAS</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #222;
    }
    input {
      width: 60%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 20px;
      border: 2px solid #888;
      border-radius: 8px;
    }
    .results {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    .result-box {
      width: 45%;
      min-height: 150px;
      background-color: #ffffff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin: 10px 0;
      overflow-y: auto;
    }
    .result-box h2 {
      text-transform: uppercase;
      color: #007BFF;
    }
    .not-found {
      margin-top: 20px;
    }
    .google-btn {
      display: none;
      margin-top: 15px;
      background-color: #dc3545;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
>>>>>>> 46eadd492432ada7deb184507bff8159947457b1
    }
    .pill { display:inline-block; padding: 6px 10px; border-radius: 999px; border:1px solid #e5e7eb; background:#fff; box-shadow: var(--shadow); }
    .meta { display: flex; justify-content: space-between; align-items: center; gap: 16px; margin: 12px 0; color:#6b7280; }
    .grid { display: grid; gap: var(--gap); grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .panel { border-radius: var(--radius); padding: 14px; box-shadow: var(--shadow); border: 1px solid #e5e7eb; background: #fff; }
    .panel h2 { margin: 0 0 8px; font-size: 1.05rem; }
    .panel ul { margin: 0; padding-left: 18px; }
    .panel small { color:#6b7280; }
    .c-consumibles { background: linear-gradient(180deg,#eefdf5,#ffffff); border-color:#bbf7d0; }
    .c-impresoras  { background: linear-gradient(180deg,#eef6ff,#ffffff); border-color:#bfdbfe; }
    .c-col-odd     { background: linear-gradient(180deg,#fff7ed,#ffffff); border-color:#fed7aa; }
    .c-col-even    { background: linear-gradient(180deg,#f5f3ff,#ffffff); border-color:#ddd6fe; }
    .error { color: #b91c1c; font-weight: 600; margin-top: 6px; }
    .hidden { display: none; }
    .footer { margin-top: 24px; color:#6b7280; font-size:.9rem; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#111827; color:#fff; font-size:.8rem; }
  </style>
</head>
<body>
<<<<<<< HEAD
  <header>
    <div class="wrap">
      <h1>Buscador de Impresoras</h1>
      <div class="searchbar">
        <input id="q" type="search" placeholder="Escribe código, referencia, nombre, compatibilidad…" list="sugerencias" autocomplete="off" />
        <button id="clearBtn" type="button">Limpiar</button>
        <datalist id="sugerencias"></datalist>
      </div>
      <div id="noFound" class="error hidden"></div>
      <div class="meta">
        <span id="count" aria-live="polite">Cargando…</span>
        <span class="pill"><span class="badge" id="groupMatches">0</span> coincidencias</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" style="margin-bottom:14px">
      <article class="panel c-consumibles">
        <h2>Consumibles relacionados</h2>
        <ul id="listConsumibles"></ul>
        <small id="infoConsumibles"></small>
      </article>
      <article class="panel c-impresoras">
        <h2>Impresoras compatibles</h2>
        <ul id="listImpresoras"></ul>
        <small id="infoImpresoras"></small>
      </article>
    </section>

    <section>
      <div class="grid" id="columnsGrid"></div>
    </section>

    <p class="footer">Fuente: <code>data/dataset.json</code> • 100% estático (sin funciones). Si no hay resultados, puedes <a id="webSearch" href="#" target="_blank" rel="noopener">buscar en Internet</a>.</p>
  </main>

  <script>
    const state = { rows: [], columns: [], consumibleCols: [], impresoraCols: [], others: [] };

    const el = (s) => document.querySelector(s);
    const els = (s) => Array.from(document.querySelectorAll(s));
    const create = (tag, props={}) => Object.assign(document.createElement(tag), props);

    function not(v){ return v===undefined || v===null || v!==v; }

    // Normaliza nombres: sin acentos, minúscula
    function norm(s){
      return s.normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();
    }

    // Asignación explícita pedida por el usuario:
    // - Consumibles: columnas que contengan "referenc" o "nombre"
    // - Impresoras: columnas que contengan "compatibil" (cubre typos tipo "compatilibilades")
    function assignGroups(cols){
      const consum = [];
      const impres = [];
      const others = [];
      cols.forEach(c => {
        const n = norm(c);
        if (n.includes('referenc') || n.includes('nombre'))      consum.push(c);
        else if (n.includes('compatibil'))                        impres.push(c);
        else                                                      others.push(c);
      });
      return { consum, impres, others };
    }

    async function load(){
      const res = await fetch('data/dataset.json', {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      state.rows = data.rows || [];
      state.columns = data.columns || Object.keys(state.rows[0]||{});

      const g = assignGroups(state.columns);
      state.consumibleCols = g.consum;
      state.impresoraCols  = g.impres;
      state.others         = g.others;

      buildDatalist();
      buildColumnsPanels();
      render();
    }

    function buildDatalist(){
      const values = new Set();
      for(const r of state.rows){
        for(const k of state.columns){
          const v = r[k];
          if(!not(v) && String(v).length >= 2) values.add(String(v));
        }
      }
      const dl = el('#sugerencias'); dl.innerHTML='';
      for(const v of Array.from(values).slice(0, 5000)){
        const o = create('option', { value: v });
        dl.appendChild(o);
      }
    }

    function buildColumnsPanels(){
      const grid = el('#columnsGrid'); grid.innerHTML='';
      state.columns.forEach((c, idx)=>{
        const art = create('article', {className:'panel '+(idx%2===0?'c-col-even':'c-col-odd')});
        art.innerHTML = `<h2>${c}</h2><ul id="col-${idx}"></ul>`;
        grid.appendChild(art);
=======
  <h1>BUSCADOR CONSUMIBLES/IMPRESORAS</h1>
  <input type="text" id="searchBox" placeholder="Escribe una referencia, modelo o marca...">

  <div class="results">
    <div class="result-box" id="consumibles">
      <h2>CONSUMIBLES</h2>
      <div id="consumiblesList"></div>
    </div>
    <div class="result-box" id="impresoras">
      <h2>IMPRESORAS</h2>
      <div id="impresorasList"></div>
    </div>
  </div>

  <div class="not-found">
    <button id="googleSearchBtn" class="google-btn">Buscar en Google</button>
  </div>

  <script>
    let dataGlobal = { consumibles: [], impresoras: [] };

    fetch("compatibilidades_completo.json")
      .then(response => response.json())
      .then(data => {
        dataGlobal = data;
        console.log("JSON cargado con ", data.consumibles.length, "consumibles y", data.impresoras.length, "impresoras");
      });

    const normalizar = texto => texto.toLowerCase().replace(/[^a-z0-9]/gi, "");

    document.getElementById("searchBox").addEventListener("input", () => {
      const input = normalizar(document.getElementById("searchBox").value);
      const consumibles = dataGlobal.consumibles.filter(item =>
        normalizar(item.referencia + item.nombre + item.compatibilidades).includes(input)
      );
      const impresoras = dataGlobal.impresoras.filter(item =>
        normalizar(item.referencia + item.nombre + item.descripcion).includes(input)
      );

      mostrarResultados(consumibles, impresoras, input);
    });

    function mostrarResultados(consumibles, impresoras, input) {
      const cList = document.getElementById("consumiblesList");
      const iList = document.getElementById("impresorasList");
      const googleBtn = document.getElementById("googleSearchBtn");

      cList.innerHTML = "";
      iList.innerHTML = "";

      if (consumibles.length === 0 && impresoras.length === 0 && input.length > 2) {
        googleBtn.style.display = "inline-block";
        googleBtn.onclick = () => {
          window.open(`https://www.google.com/search?q=${input}`, '_blank');
        };
      } else {
        googleBtn.style.display = "none";
      }

      consumibles.forEach(item => {
        cList.innerHTML += `<p><strong>${item.referencia}</strong> - ${item.nombre} - ${item.capacidad || ''} - ${item.precio || ''}</p>`;
      });

      impresoras.forEach(item => {
        iList.innerHTML += `<p><strong>${item.referencia}</strong> - ${item.nombre}<br><small>${item.descripcion}</small></p>`;
>>>>>>> 46eadd492432ada7deb184507bff8159947457b1
      });
    }

    function searchRows(q){
      if(!q) return state.rows;
      const ql = q.toLowerCase();
      return state.rows.filter(r => {
        for(const k of state.columns){
          const v = r[k];
          if(!not(v) && String(v).toLowerCase().includes(ql)) return true;
        }
        return false;
      });
    }

    function uniqueList(rows, cols){
      const set = new Set();
      for(const r of rows){
        for(const c of cols){
          const v = r[c];
          if(!not(v)){
            const s = String(v).trim();
            if(s) set.add(s);
          }
        }
      }
      return Array.from(set).sort((a,b)=>a.localeCompare(b,'es'));
    }

    function render(){
      const q = el('#q').value.trim();
      el('#q').classList.toggle('active', q.length>0);

      const rows = searchRows(q);
      el('#count').textContent = `${rows.length} fila${rows.length===1?'':'s'}`;
      el('#groupMatches').textContent = rows.length;

      // No encontrado
      const nf = el('#noFound');
      if(q && rows.length===0){
        nf.textContent = `Código no encontrado: ${q}`;
        nf.classList.remove('hidden');
        const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(q)}`;
        el('#webSearch').href = googleUrl;
      } else {
        nf.classList.add('hidden');
      }

      // Consumibles (referencias + nombre)
      const consum = uniqueList(rows, state.consumibleCols);
      const lc = el('#listConsumibles'); lc.innerHTML='';
      consum.slice(0,200).forEach(v => lc.appendChild(create('li', { textContent: v })));
      el('#infoConsumibles').textContent = consum.length ? `${consum.length} elemento${consum.length===1?'':'s'}` : '';

      // Impresoras (compatibilidades)
      const imp = uniqueList(rows, state.impresoraCols);
      const li = el('#listImpresoras'); li.innerHTML='';
      imp.slice(0,200).forEach(v => li.appendChild(create('li', { textContent: v })));
      el('#infoImpresoras').textContent = imp.length ? `${imp.length} elemento${imp.length===1?'':'s'}` : '';

      // Paneles por columna (orden del CSV)
      state.columns.forEach((c, idx)=>{
        const ul = el(`#col-${idx}`);
        if(!ul) return;
        const vals = uniqueList(rows, [c]).slice(0,200);
        ul.innerHTML='';
        vals.forEach(v => ul.appendChild(create('li', { textContent: v })));
      });
    }

    // Eventos
    el('#q').addEventListener('input', render);
    el('#clearBtn').addEventListener('click', ()=>{ el('#q').value=''; render(); });

    load().catch(err => {
      console.error(err);
      el('#count').textContent = 'Error cargando datos';
    });
  </script>
</body>
</html>