<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BUSCADOR DE IMPRESORAS</title>
  <style>
    :root { --gap: 14px; --radius: 12px; --shadow: 0 8px 20px rgba(0,0,0,0.06); }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #f6f7f9; color: #111; }
    header { text-align: center; padding: 2rem 1rem; background: #fff; box-shadow: var(--shadow); }
    header h1 { margin: 0; font-size: 2.75rem; }
    .searchbar { margin: 1.5rem auto; display: flex; gap: .5rem; justify-content: center; }
    .searchbar input {
      width: 280px; padding: .75rem 1rem; border: 2px solid #ccc; border-radius: 999px; outline: none;
      transition: border-color .2s, box-shadow .2s;
    }
    .searchbar input.active { border-color: #4285F4; box-shadow: 0 0 8px rgba(66,133,244,0.5); }
    .searchbar button { padding: .75rem 1.25rem; border: none; border-radius: 999px; background: #4285F4; color: white; cursor: pointer; }
    .message { text-align: center; margin: .5rem 0; }
    .message.error { color: #D93025; font-weight: bold; }
    .message.info { color: #555; }
    main { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    .grid { display: grid; gap: var(--gap); grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .panel { background: white; border-radius: var(--radius); padding: 1rem; box-shadow: var(--shadow); border: 1px solid #e2e2e2; }
    .panel h2 { margin-top: 0; font-size: 1.2rem; }
    .panel ul { margin: 0; padding-left: 1.25rem; max-height: 200px; overflow-y: auto; }
    .c-consumibles { border-color: #0F9D58; background: #E6F4EA; }
    .c-impresoras { border-color: #DB4437; background: #FDE7E7; }
    .c-col-odd { border-color: #F4B400; background: #FEF7E0; }
    .c-col-even { border-color: #0F9D58; background: #E6F4EA; }
    #btnGoogle { display: block; margin: 1rem auto; padding: .75rem 1.5rem; border: none; border-radius: var(--radius);
      background: linear-gradient(90deg, #4285F4 25%, #DB4437 50%, #F4B400 75%, #0F9D58); color: white; font-size: 1rem; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>BUSCADOR DE IMPRESORAS</h1>
    <div class="searchbar">
      <input id="search" type="search" placeholder="Ingresa referencia, nombre o compatibilidad..." />
      <button id="clear">Limpiar</button>
    </div>
    <div id="msgError" class="message error" style="display:none;"></div>
    <div id="msgInfo" class="message info">Cargando datos...</div>
  </header>
  <main>
    <section class="grid" id="mainPanels">
      <div class="panel c-consumibles"><h2>CONSUMIBLES</h2><ul id="panelConsumibles"></ul></div>
      <div class="panel c-impresoras"><h2>IMPRESORAS</h2><ul id="panelImpresoras"></ul></div>
    </section>
    <section class="grid" id="extraPanels"></section>
    <button id="btnGoogle" style="display:none;">BUSCAR EN GOOGLE</button>
  </main>
  <script>
    // Normalize string
    const normalize = s => s?.normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().replace(/[^a-z0-9]/g,'') || '';
    let rows = [], cols = [], consumCols = [], impresCols = [], otherCols = [];
    // Fetch JSON
    fetch('data/dataset_clean.json')
      .then(r => r.json())
      .then(data => {
        rows = data.rows || [];
        cols = data.columns || [];
        cols.forEach(c => {
          const key = normalize(c);
          if (key.includes('referenc') || key.includes('nombre')) consumCols.push(c);
          else if (key.includes('compatibil')) impresCols.push(c);
          else otherCols.push(c);
        });
        document.getElementById('msgInfo').style.display = 'none';
        renderAll(rows);
      })
      .catch(() => {
        document.getElementById('msgInfo').textContent = 'Error al cargar datos';
      });
    // Render both main and extra panels based on filtered rows
    function renderAll(filtered) {
      renderMain(filtered);
      renderExtra(filtered);
    }
    function renderMain(filtered) {
      const panelC = document.getElementById('panelConsumibles');
      const panelI = document.getElementById('panelImpresoras');
      panelC.innerHTML = '';
      panelI.innerHTML = '';
      filtered.forEach(r => {
        consumCols.forEach(c => { const v = r[c]; if (v) panelC.appendChild(li(v)); });
        impresCols.forEach(c => { const v = r[c]; if (v) panelI.appendChild(li(v)); });
      });
    }
    function renderExtra(filtered) {
      const container = document.getElementById('extraPanels');
      container.innerHTML = '';
      otherCols.forEach((c, i) => {
        const div = document.createElement('div');
        div.className = 'panel ' + (i % 2 ? 'c-col-even' : 'c-col-odd');
        const ul = document.createElement('ul');
        filtered.forEach(r => {
          const v = r[c]; if (v) ul.appendChild(li(v));
        });
        div.innerHTML = `<h2>${c}</h2>`;
        div.appendChild(ul);
        container.appendChild(div);
      });
    }
    function li(text) { const li = document.createElement('li'); li.textContent = text; return li; }
    // Search logic
    function onSearch() {
      const term = normalize(document.getElementById('search').value);
      const err = document.getElementById('msgError');
      const info = document.getElementById('msgInfo');
      const btnG = document.getElementById('btnGoogle');
      if (!term) {
        err.style.display = 'none'; btnG.style.display = 'none';
        renderAll(rows);
        return;
      }
      const filtered = rows.filter(r => cols.some(c => normalize(r[c]).includes(term)));
      if (filtered.length === 0) {
        err.textContent = `CÃ“DIGO NO ENCONTRADO: ${document.getElementById('search').value}`;
        err.style.display = 'block';
        btnG.style.display = 'block';
        btnG.onclick = () => window.open(`https://www.google.com/search?q=${encodeURIComponent(document.getElementById('search').value)}`, '_blank');
      } else {
        err.style.display = 'none'; btnG.style.display = 'none';
      }
      renderAll(filtered);
    }
    document.getElementById('search').addEventListener('input', onSearch);
    document.getElementById('clear').addEventListener('click', () => { document.getElementById('search').value = ''; onSearch(); });
  </script>
</body>
</html>
