<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BUSCADOR DE CONSUMIBLES E IMPRESORAS</title>
  <style>
    :root {
      --radius: 12px;
      --shadow: 0 4px 15px rgba(0,0,0,0.1);
      --color-printer: #e3f2fd;
      --color-consumable: #f1f8e9;
      --input-border: #ccc;
      --error-color: #DB4437;
      --btn-clear: #0F9D58;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f5f5f5; color: #333;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
    }
    header {
      width: 100%; padding: 2rem 1rem;
      background: linear-gradient(90deg, #2196F3, #4CAF50);
      box-shadow: var(--shadow);
      text-align: center;
      display: flex; flex-direction: column; align-items: center;
    }
    header h1 {
      font-size: 2rem; margin-bottom: 1rem;
      text-transform: uppercase; color: #000;
    }
    .searchbar {
      display: flex; width: 100%; max-width: 500px; margin-top: 1rem;
    }
    .searchbar input {
      flex: 1; padding: 0.75rem 1rem;
      border: 1px solid var(--input-border);
      border-radius: var(--radius) 0 0 var(--radius);
      font-size: 1rem; background: #fff; box-shadow: var(--shadow);
    }
    .searchbar button {
      padding: 0.75rem 1rem; border: 1px solid var(--input-border);
      border-left: none; border-radius: 0 var(--radius) var(--radius) 0;
      background: var(--btn-clear); color: #fff; cursor: pointer;
      box-shadow: var(--shadow);
    }
    .error {
      margin-top: 0.5rem; color: var(--error-color);
      min-height: 1.4em; text-align: center; visibility: hidden;
    }
    .grid {
      display: flex; gap: 1rem; margin: 2rem; width: 100%;
      max-width: 800px; justify-content: center;
    }
    .card {
      flex: 1 1 40%; background: #fff;
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 1rem; max-height: 300px; overflow-y: auto;
    }
    .card h2 {
      font-size: 1.25rem; margin-bottom: 0.5rem;
      text-transform: uppercase; color: #000;
    }
    .card ul { list-style: none; padding: 0; margin: 0; }
    .card li {
      padding: 0.5rem 0; border-bottom: 1px solid #ddd;
      text-transform: uppercase; font-size: 0.95rem;
    }
    #consumiblesCard { background: var(--color-consumable); }
    #impresorasCard { background: var(--color-printer); }
    .google-btn {
      margin: 1rem auto 2rem; padding: 0.75rem 2rem;
      border: none; border-radius: var(--radius);
      background: #DB4437; color: #fff; font-size: 1rem;
      cursor: pointer; box-shadow: var(--shadow);
    }
  </style>
</head>
<body>
  <header>
    <h1>Buscador de Consumibles e Impresoras</h1>
    <div class="searchbar">
      <input id="searchInput" type="text" placeholder="Ej. HP1200, 001R00623, Canon..." />
      <button id="clearBtn">Limpiar</button>
    </div>
    <div class="error" id="errorMsg"></div>
  </header>
  <div class="grid">
    <div class="card" id="consumiblesCard">
      <h2>Consumibles</h2>
      <ul id="consumiblesList"></ul>
    </div>
    <div class="card" id="impresorasCard">
      <h2>Impresoras</h2>
      <ul id="impresorasList"></ul>
    </div>
  </div>
  <button class="google-btn" id="googleBtn">Buscar en Google</button>
  <script>
    function normalize(s) {
      return String(s||'').toLowerCase().normalize('NFD')
        .replace(/[̀-ͯ]/g,'')
        .replace(/[^a-z0-9]/g,'');
    }

    let data = [], printerMap = {}, consumibleMap = {}, referenceMap = {};
    fetch('./consumibles_impresoras_full.json')
      .then(r => r.json())
      .then(json => {
        data = json;
        data.forEach(item => {
          const pr = normalize(item.IMPRESORAS);
          const co = normalize(item.CONSUMIBLES);
          const rf = normalize(item.REFERENCIA);
          printerMap[pr] = printerMap[pr]||new Set();
          consumibleMap[co] = consumibleMap[co]||new Set();
          referenceMap[rf] = referenceMap[rf]||{impr:new Set(), cons:new Set()};

          printerMap[pr].add(item.CONSUMIBLES);
          consumibleMap[co].add(item.IMPRESORAS);

          (item.COMPATIBILIDADES||[]).forEach(p => {
            const pp = normalize(p);
            printerMap[pp] = printerMap[pp]||new Set();
            printerMap[pp].add(item.CONSUMIBLES);
            consumibleMap[co].add(p);
          });

          referenceMap[rf].impr.add(item.IMPRESORAS);
          referenceMap[rf].cons.add(item.CONSUMIBLES);
        });
      })
      .catch(() => {
        const e = document.getElementById('errorMsg');
        e.textContent = 'Error cargando datos'; e.style.visibility = 'visible';
      });

    const inp = document.getElementById('searchInput'),
          clearBtn = document.getElementById('clearBtn'),
          err = document.getElementById('errorMsg'),
          consumList = document.getElementById('consumiblesList'),
          impresList = document.getElementById('impresorasList'),
          googleBtn = document.getElementById('googleBtn');

    clearBtn.onclick = () => {
      inp.value=''; err.style.visibility='hidden';
      consumList.innerHTML=''; impresList.innerHTML=''; inp.focus();
    };
    inp.addEventListener('keydown', e => { if(e.key==='Enter') runSearch(); });
    googleBtn.onclick = () => {
      let q = inp.value.trim();
      if(q) window.open('https://www.google.com/search?q='+encodeURIComponent(q),'_blank');
    };

    function runSearch() {
      const raw = inp.value.trim();
      if(!raw) return;
      err.style.visibility='hidden';
      consumList.innerHTML=''; impresList.innerHTML='';

      const norm = normalize(raw);
      const cons = new Set(), impr = new Set();

      if(referenceMap[norm]) {
        referenceMap[norm].cons.forEach(c=>cons.add(c.toUpperCase()));
        referenceMap[norm].impr.forEach(i=>impr.add(i.toUpperCase()));
      }
      if(consumibleMap[norm]) {
        consumibleMap[norm].forEach(i=>impr.add(i.toUpperCase()));
        Object.keys(printerMap).forEach(p =>{
          printerMap[p].forEach(c=>{
            if(normalize(c)===norm) impr.add(p.toUpperCase());
          });
        });
        data.filter(d=>normalize(d.CONSUMIBLES)===norm)
            .forEach(d=>cons.add(d.CONSUMIBLES.toUpperCase()));
      }
      if(printerMap[norm]) {
        printerMap[norm].forEach(c=>cons.add(c.toUpperCase()));
        data.filter(d=>normalize(d.IMPRESORAS)===norm)
            .forEach(d=>impr.add(d.IMPRESORAS.toUpperCase()));
      }

      if(!cons.size && !impr.size) {
        err.textContent=`Código no encontrado: ${raw}`; err.style.visibility='visible';
        return;
      }
      cons.forEach(c=>{
        const li = document.createElement('li');
        li.textContent = c;
        consumList.appendChild(li);
      });
      impr.forEach(i=>{
        const li = document.createElement('li');
        li.textContent = i;
        impresList.appendChild(li);
      });
    }
  </script>
</body>
</html>